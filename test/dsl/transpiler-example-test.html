<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>DSL Transpiler - Real Example Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1400px;
      margin: 20px auto;
      padding: 0 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      color: #4EC9B0;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .panel {
      background: #2d2d30;
      padding: 16px;
      border-radius: 4px;
    }
    .panel h2 {
      margin-top: 0;
      color: #4EC9B0;
      font-size: 18px;
    }
    pre {
      background: #1e1e1e;
      padding: 12px;
      border-radius: 3px;
      overflow-x: auto;
      border-left: 3px solid #4EC9B0;
      font-size: 13px;
      line-height: 1.5;
    }
    .status {
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d30;
      border-radius: 4px;
    }
    .pass {
      color: #4CAF50;
    }
    .fail {
      color: #f44336;
    }
  </style>
</head>
<body>
  <h1>DSL Transpiler - Real Example Test</h1>

  <div class="status" id="status"></div>

  <div class="container">
    <div class="panel">
      <h2>DSL Input</h2>
      <pre id="dsl-input"></pre>
    </div>

    <div class="panel">
      <h2>Transpiled JavaScript</h2>
      <pre id="js-output"></pre>
    </div>
  </div>

  <script src="transpiler.js"></script>
  <script>
    // Example from dsl-examples.md: "Replace 'Hello ' with 'X'"
    const dslSource = `TYPE "Hello World"
left with meta

right 5 times with shift

TYPE "X"

expect(fixture.wb.Selection.isSelection).toBe(false);
expect(fixture).toHaveLines('XWorld');
const [start, end] = fixture.wb.Selection.ordered;
expect(start).toEqual({ row: 0, col: 1 });
expect(end).toEqual({ row: 0, col: 1 });`;

    const expectedOutput = `fixture.type('Hello World');
fixture.press(Key.ArrowLeft).withMetaKey().once();

fixture.press(Key.ArrowRight).withShiftKey().times(5);

fixture.type('X');

expect(fixture.wb.Selection.isSelection).toBe(false);
expect(fixture).toHaveLines('XWorld');
const [start, end] = fixture.wb.Selection.ordered;
expect(start).toEqual({ row: 0, col: 1 });
expect(end).toEqual({ row: 0, col: 1 });`;

    const transpiler = new DSLTranspiler();
    let output, passed;

    try {
      output = transpiler.transpile(dslSource);
      passed = output === expectedOutput;

      document.getElementById('dsl-input').textContent = dslSource;
      document.getElementById('js-output').textContent = output;

      const statusDiv = document.getElementById('status');
      if (passed) {
        statusDiv.innerHTML = '<span class="pass">✓ Transpilation successful! Output matches expected JavaScript.</span>';
      } else {
        statusDiv.innerHTML = '<span class="fail">✗ Transpilation output does not match expected.</span>';
        console.log('Expected:', expectedOutput);
        console.log('Got:', output);
      }
    } catch (e) {
      document.getElementById('status').innerHTML = `<span class="fail">✗ Error: ${e.message}</span>`;
      document.getElementById('dsl-input').textContent = dslSource;
      document.getElementById('js-output').textContent = `Error: ${e.message}\n\n${e.stack}`;
    }
  </script>
</body>
</html>
